---
import "../styles/global.css";

type NavChild = {
  href: string;
  label: string;
};

type NavItem = NavChild & {
  children?: NavChild[];
};

const {
  title = "My website",
  description = "Portfolio & blog",
  lang = "fr",
} = Astro.props;

const nav: NavItem[] = [
  { href: "/", label: "Home" },
  {
    href: "/experience",
    label: "Experience",
    children: [
      { href: "/experience/cv", label: "CV" },
      { href: "/experience/work", label: "Work" },
      { href: "/experience/association", label: "Association" },
      { href: "/experience/education", label: "Education" },
    ],
  },
  { href: "/blog", label: "Blog" },
  { href: "/projects", label: "Projects" },
  { href: "/interesting", label: "Interesting" },
];

const currentPath = Astro.url.pathname;
const isActive = (href: string) =>
  currentPath === href || (href !== "/" && currentPath.startsWith(href + "/"));

const isExact = (href: string) => currentPath === href;
---

<!DOCTYPE html>
<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="theme-color" content="#243553" />
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/logos/leaf.png" />
    <link rel="apple-touch-icon" href="/logos/leaf.png" />
    <!-- RSS feed -->
    <link
      rel="alternate"
      type="application/rss+xml"
      href="/rss.xml"
      title="Blog &mdash; Lo&#239;c Marigny"
    />

    <!-- Google Fonts: Bricolage Grotesque -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@300..800&display=swap"
      rel="stylesheet"
    />

    <!-- Basic Open Graph metadata (adjust as needed) -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content="/og-default.jpg" />
  </head>

  <body>
    <header class="site-header">
      <div class="nav-wrapper">
        <a href="/" class="brand-logo" aria-label="Home">
          <img src="/logos/loic-marigny-logo-long.png" alt="Lo&#239;c Marigny logo" />
        </a>

        <nav class="nav" aria-label="Main navigation">
          <ul class="nav-list">
            {
              nav.map((item) => (
                <li
                  class:list={[
                    "nav-item",
                    { "nav-item--has-submenu": !!item.children },
                  ]}
                >
                  <a
                    class="nav-link"
                    href={item.href}
                    aria-current={
                      item.children
                        ? isExact(item.href)
                          ? "page"
                          : undefined
                        : isActive(item.href)
                        ? "page"
                        : undefined
                    }
                    aria-haspopup={item.children ? "true" : undefined}
                  >
                    {item.label}
                  </a>

                  {item.children && (
                    <div class="submenu-panel">
                      <ul class="submenu" aria-label={`${item.label} submenu`}>
                        {item.children.map((child) => (
                          <li class="submenu-item">
                            <a
                              class="submenu-link"
                              href={child.href}
                              aria-current={isActive(child.href) ? "page" : undefined}
                            >
                              {child.label}
                            </a>
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}
                </li>
              ))
            }
          </ul>
        </nav>
      </div>
    </header>

    <main>
      <slot />
    </main>

    <footer>
      <div class="footer-grid">
        <div class="footer-left">
          &copy; {new Date().getFullYear()} &middot; Lo&#239;c Marigny
        </div>

        <div class="footer-center" aria-label="Footer navigation">
          <a class="footer-link" href="/about">About</a>
          <a class="footer-link" href="/contact">Contact</a>
        </div>

        <nav class="footer-right socials" aria-label="Social links">
          <a
            href="https://instagram.com/loic_marigny"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="Instagram"
          >
            <img src="https://cdn.simpleicons.org/instagram/FFFFFF" alt="Instagram" loading="lazy" />
          </a>
          <a
            href="https://x.com/LoicMarigny"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="X (Twitter)"
          >
            <img src="https://cdn.simpleicons.org/x/FFFFFF" alt="X (Twitter)" loading="lazy" />
          </a>
          <a
            href="https://www.linkedin.com/in/loic-marigny"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="LinkedIn"
          >
            <img src="/icons/linkedin-logo.svg" alt="LinkedIn" loading="lazy" />
            <span class="visually-hidden">LinkedIn</span>
          </a>
          <a
            href="https://github.com/loic-marigny"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="GitHub"
          >
            <img src="https://cdn.simpleicons.org/github/FFFFFF" alt="GitHub" loading="lazy" />
          </a>
          <a
            href="https://www.goodreads.com/user/show/178085152"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="Goodreads"
          >
            <img src="https://cdn.simpleicons.org/goodreads/FFFFFF" alt="Goodreads" loading="lazy" />
          </a>
          <a
            href="https://boxd.it/8s2yN"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="Letterboxd"
          >
            <img src="https://cdn.simpleicons.org/letterboxd/FFFFFF" alt="Letterboxd" loading="lazy" />
          </a>
        </nav>
      </div>
    </footer>
  </body>
</html>
