---
import Layout from "../../layouts/Layout.astro";
import "../../styles/coming-map.css";
import {
  mapCategories,
  countryColors,
  stateColors,
  DEFAULT_FILL_COLOR
} from "../../data/mapDestinations";
import comingMapScript from "../../scripts/comingMap.ts?url";

const serializedCountryColors = JSON.stringify(countryColors);
const serializedStateColors = JSON.stringify(stateColors);
const defaultFillColor = DEFAULT_FILL_COLOR;
---

<Layout title="A venir" description="My goals and objectives.">
  <h1>À venir</h1>
  <p>Voici quelques objectifs et projets que je prévois de réaliser dans un avenir proche :</p>
  <ul>
    <li>Participer à un hackathon local</li>
    <li>Contribuer à un projet open-source</li>
    <li>Apprendre une nouvelle technologie (par exemple, Svelte ou Rust)</li>
  </ul>
  <p>J'ai également l'intention de travailler à l'étranger. Voilà une carte légendée du monde, indiquant les endroits où j'aimerais travailler.</p>

  <!-- Conteneur carte + légende + contrôle -->
  <section class="map-section">
    <div class="map-header">
      <label for="colorFilter">Filtrer par couleur :</label>
      <select id="colorFilter">
        <option value="__all__">Tous</option>
        {mapCategories.map((category) => (
          <option value={category.color}>{category.label}</option>
        ))}
      </select>
    </div>

    <div
      id="map"
      class="map-container"
      aria-label="Carte du monde interactif montrant mes destinations potentielles"
      data-country-colors={serializedCountryColors}
      data-state-colors={serializedStateColors}
      data-default-fill-color={defaultFillColor}
    ></div>

    <div class="legend" aria-hidden="false">
      {mapCategories.map((category) => (
        <div class="legend-item">
          <span class="swatch" style={`background:${category.color};`}></span>
          <span>{category.label}</span>
        </div>
      ))}
      <div class="legend-hint">
        Survolez une zone pour plus d'infos.
      </div>
    </div>

    <!-- Popup custom -->
    <div id="hoverPopup" class="hover-popup" role="status" aria-live="polite"></div>
  </section>
  <!-- Dépendances MapLibre GL -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css"
  />
  <script
    src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"
    defer
  ></script>

  <!-- Script carte -->
  <script type="module" src={comingMapScript}></script>
</Layout>
